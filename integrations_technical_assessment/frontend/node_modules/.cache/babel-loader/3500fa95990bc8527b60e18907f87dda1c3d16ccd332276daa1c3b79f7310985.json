{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\bharg\\\\Downloads\\\\automations_technical_assessment\\\\integrations_technical_assessment\\\\frontend\\\\src\\\\integrations\\\\hubspot.js\",\n  _s = $RefreshSig$();\n// frontend/src/integrations/hubspot.js\n\nimport { useState, useEffect } from 'react';\nimport { Box, Button, CircularProgress } from '@mui/material';\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const HubspotIntegration = ({\n  user,\n  org,\n  integrationParams,\n  setIntegrationParams\n}) => {\n  _s();\n  const [isConnected, setIsConnected] = useState(false);\n  const [isConnecting, setIsConnecting] = useState(false);\n  useEffect(() => {\n    // optionally set isConnected from integrationParams\n    if (integrationParams && integrationParams.hubspot) {\n      setIsConnected(true);\n    }\n  }, [integrationParams]);\n  const openOAuthPopup = () => {\n    setIsConnecting(true);\n    const width = 600,\n      height = 700;\n    const left = window.screen.width / 2 - width / 2;\n    const top = window.screen.height / 2 - height / 2;\n    const popup = window.open('', 'hubspot_oauth', `width=${width},height=${height},top=${top},left=${left}`);\n    const formData = new FormData();\n    formData.append('user_id', (user === null || user === void 0 ? void 0 : user.id) || '');\n    formData.append('org_id', (org === null || org === void 0 ? void 0 : org.id) || '');\n    axios.post('http://localhost:8000/integrations/hubspot/authorize', formData, {\n      responseType: 'text'\n    }).then(response => {\n      if (!popup || popup.closed) {\n        // Popup blocked or closed; open a new tab instead\n        const oauthHtml = response.data;\n        // try to extract the URL from the HTML response\n        const m = oauthHtml.match(/window\\.location\\s*=\\s*[\"']([^\"']+)[\"']/);\n        if (m && m[1]) {\n          window.open(m[1], '_blank');\n        } else {\n          // fallback: just write the HTML\n          const w = window.open();\n          w.document.open();\n          w.document.write(oauthHtml);\n          w.document.close();\n        }\n        // start polling regardless\n        pollForCredentials();\n        return;\n      }\n\n      // try to extract the redirect URL from the HTML our backend returned\n      try {\n        const html = response.data;\n        const match = html.match(/window\\.location\\s*=\\s*[\"']([^\"']+)[\"']/);\n        if (match && match[1]) {\n          // set the popup location to the HubSpot OAuth URL\n          popup.location.href = match[1];\n        } else {\n          // fallback to writing the HTML into the popup if regex fails\n          popup.document.open();\n          popup.document.write(response.data);\n          popup.document.close();\n        }\n      } catch (err) {\n        // as a fallback, write the HTML into the popup\n        try {\n          popup.document.open();\n          popup.document.write(response.data);\n          popup.document.close();\n        } catch (e) {\n          console.error('Could not navigate popup', e);\n        }\n      }\n\n      // start polling for credentials once the popup is sent to HubSpot\n      pollForCredentials();\n    }).catch(err => {\n      console.error('Authorize error', err);\n      setIsConnecting(false);\n    });\n  };\n  const pollForCredentials = async () => {\n    let attempts = 0;\n    const maxAttempts = 15;\n    const intervalMs = 1000;\n    const tryFetch = async () => {\n      attempts += 1;\n      const formData = new FormData();\n      formData.append('user_id', (user === null || user === void 0 ? void 0 : user.id) || '');\n      formData.append('org_id', (org === null || org === void 0 ? void 0 : org.id) || '');\n      try {\n        const resp = await axios.post('http://localhost:8000/integrations/hubspot/credentials', formData);\n        if (resp.data && resp.data.access_token) {\n          setIntegrationParams({\n            ...integrationParams,\n            hubspot: resp.data\n          });\n          setIsConnected(true);\n          setIsConnecting(false);\n          return;\n        }\n      } catch (e) {\n        // credentials not available yet\n      }\n      if (attempts < maxAttempts) {\n        setTimeout(tryFetch, intervalMs);\n      } else {\n        setIsConnecting(false);\n      }\n    };\n    setTimeout(tryFetch, 1000);\n  };\n  return /*#__PURE__*/_jsxDEV(Box, {\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    p: 1,\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontWeight: 600\n        },\n        children: \"HubSpot\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontSize: 12,\n          color: '#666'\n        },\n        children: \"Connect HubSpot to import contacts/deals\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      children: /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"outlined\",\n        onClick: openOAuthPopup,\n        disabled: isConnecting || isConnected,\n        style: {\n          pointerEvents: isConnected ? 'none' : 'auto',\n          cursor: isConnected ? 'default' : 'pointer',\n          opacity: isConnected ? 1 : undefined\n        },\n        children: isConnecting ? /*#__PURE__*/_jsxDEV(CircularProgress, {\n          size: 20\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 138,\n          columnNumber: 37\n        }, this) : isConnected ? 'HubSpot Connected' : 'Connect to HubSpot'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 9\n  }, this);\n};\n_s(HubspotIntegration, \"YVzh0k4rAm9dKRmEfKk5oscD40o=\");\n_c = HubspotIntegration;\nvar _c;\n$RefreshReg$(_c, \"HubspotIntegration\");","map":{"version":3,"names":["useState","useEffect","Box","Button","CircularProgress","axios","jsxDEV","_jsxDEV","HubspotIntegration","user","org","integrationParams","setIntegrationParams","_s","isConnected","setIsConnected","isConnecting","setIsConnecting","hubspot","openOAuthPopup","width","height","left","window","screen","top","popup","open","formData","FormData","append","id","post","responseType","then","response","closed","oauthHtml","data","m","match","w","document","write","close","pollForCredentials","html","location","href","err","e","console","error","catch","attempts","maxAttempts","intervalMs","tryFetch","resp","access_token","setTimeout","display","alignItems","justifyContent","p","children","style","fontWeight","fileName","_jsxFileName","lineNumber","columnNumber","fontSize","color","variant","onClick","disabled","pointerEvents","cursor","opacity","undefined","size","_c","$RefreshReg$"],"sources":["C:/Users/bharg/Downloads/automations_technical_assessment/integrations_technical_assessment/frontend/src/integrations/hubspot.js"],"sourcesContent":["// frontend/src/integrations/hubspot.js\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport {\r\n    Box,\r\n    Button,\r\n    CircularProgress\r\n} from '@mui/material';\r\nimport axios from 'axios';\r\n\r\nexport const HubspotIntegration = ({ user, org, integrationParams, setIntegrationParams }) => {\r\n    const [isConnected, setIsConnected] = useState(false);\r\n    const [isConnecting, setIsConnecting] = useState(false);\r\n\r\n    useEffect(() => {\r\n        // optionally set isConnected from integrationParams\r\n        if (integrationParams && integrationParams.hubspot) {\r\n            setIsConnected(true);\r\n        }\r\n    }, [integrationParams]);\r\n\r\n    const openOAuthPopup = () => {\r\n        setIsConnecting(true);\r\n        const width = 600, height = 700;\r\n        const left = (window.screen.width / 2) - (width / 2);\r\n        const top = (window.screen.height / 2) - (height / 2);\r\n        const popup = window.open('', 'hubspot_oauth', `width=${width},height=${height},top=${top},left=${left}`);\r\n\r\n        const formData = new FormData();\r\n        formData.append('user_id', user?.id || '');\r\n        formData.append('org_id', org?.id || '');\r\n\r\n        axios.post('http://localhost:8000/integrations/hubspot/authorize', formData, { responseType: 'text' })\r\n                        .then((response) => {\r\n                if (!popup || popup.closed) {\r\n                    // Popup blocked or closed; open a new tab instead\r\n                    const oauthHtml = response.data;\r\n                    // try to extract the URL from the HTML response\r\n                    const m = oauthHtml.match(/window\\.location\\s*=\\s*[\"']([^\"']+)[\"']/);\r\n                    if (m && m[1]) {\r\n                        window.open(m[1], '_blank');\r\n                    } else {\r\n                        // fallback: just write the HTML\r\n                        const w = window.open();\r\n                        w.document.open();\r\n                        w.document.write(oauthHtml);\r\n                        w.document.close();\r\n                    }\r\n                    // start polling regardless\r\n                    pollForCredentials();\r\n                    return;\r\n                }\r\n\r\n                // try to extract the redirect URL from the HTML our backend returned\r\n                try {\r\n                    const html = response.data;\r\n                    const match = html.match(/window\\.location\\s*=\\s*[\"']([^\"']+)[\"']/);\r\n                    if (match && match[1]) {\r\n                        // set the popup location to the HubSpot OAuth URL\r\n                        popup.location.href = match[1];\r\n                    } else {\r\n                        // fallback to writing the HTML into the popup if regex fails\r\n                        popup.document.open();\r\n                        popup.document.write(response.data);\r\n                        popup.document.close();\r\n                    }\r\n                } catch (err) {\r\n                    // as a fallback, write the HTML into the popup\r\n                    try {\r\n                        popup.document.open();\r\n                        popup.document.write(response.data);\r\n                        popup.document.close();\r\n                    } catch (e) {\r\n                        console.error('Could not navigate popup', e);\r\n                    }\r\n                }\r\n\r\n                // start polling for credentials once the popup is sent to HubSpot\r\n                pollForCredentials();\r\n            })\r\n\r\n            .catch((err) => {\r\n                console.error('Authorize error', err);\r\n                setIsConnecting(false);\r\n            });\r\n    };\r\n\r\n    const pollForCredentials = async () => {\r\n        let attempts = 0;\r\n        const maxAttempts = 15;\r\n        const intervalMs = 1000;\r\n\r\n        const tryFetch = async () => {\r\n            attempts += 1;\r\n            const formData = new FormData();\r\n            formData.append('user_id', user?.id || '');\r\n            formData.append('org_id', org?.id || '');\r\n            try {\r\n                const resp = await axios.post('http://localhost:8000/integrations/hubspot/credentials', formData);\r\n                if (resp.data && resp.data.access_token) {\r\n                    setIntegrationParams({\r\n                        ...integrationParams,\r\n                        hubspot: resp.data\r\n                    });\r\n                    setIsConnected(true);\r\n                    setIsConnecting(false);\r\n                    return;\r\n                }\r\n            } catch (e) {\r\n                // credentials not available yet\r\n            }\r\n            if (attempts < maxAttempts) {\r\n                setTimeout(tryFetch, intervalMs);\r\n            } else {\r\n                setIsConnecting(false);\r\n            }\r\n        };\r\n        setTimeout(tryFetch, 1000);\r\n    };\r\n\r\n    return (\r\n        <Box display=\"flex\" alignItems=\"center\" justifyContent=\"space-between\" p={1}>\r\n            <div>\r\n                <div style={{fontWeight: 600}}>HubSpot</div>\r\n                <div style={{fontSize: 12, color: '#666'}}>Connect HubSpot to import contacts/deals</div>\r\n            </div>\r\n            <Box>\r\n                <Button\r\n                    variant=\"outlined\"\r\n                    onClick={openOAuthPopup}\r\n                    disabled={isConnecting || isConnected}\r\n                    style={{\r\n                        pointerEvents: isConnected ? 'none' : 'auto',\r\n                        cursor: isConnected ? 'default' : 'pointer',\r\n                        opacity: isConnected ? 1 : undefined\r\n                    }}\r\n                >\r\n                    {isConnecting ? <CircularProgress size={20} /> : isConnected ? 'HubSpot Connected' : 'Connect to HubSpot'}\r\n                </Button>\r\n            </Box>\r\n        </Box>\r\n    );\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}